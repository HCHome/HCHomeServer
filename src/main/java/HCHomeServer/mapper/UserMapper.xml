<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HCHomeServer.mapper.UserMapper">
	<resultMap type="HCHomeServer.model.db.User" id="userMap">
		<id property="userId" column="user_id"/>
		<result property="nickname" column="nickname"/>
		<result property="signScore" column="sign_score"/>
		<result property="infoId" column="info_id"/>
		<result property="wechatIdentify" column="wechat_identify"/>
		<result property="avatar" column="avatar"/>
	</resultMap>
	<select id="getUserByOpenId" parameterType="String" resultMap="userMap">
		select *
		from users
		where wechat_identify = #{openId}
	</select>
	<insert id="addUser" parameterType="HCHomeServer.model.db.User" useGeneratedKeys="true" keyProperty="userId">
		insert into users(info_id, nickname, sign_score, wechat_identify, avatar) values
		(#{infoId},#{nickname},#{signScore},#{wechatIdentify},#{avatar})
	</insert>
	<update id="signScoreAdd">
		update users set sign_score = #{score}+(select sign_score from (select sign_score from users where user_id = #{userId})as temp)
		where user_id = #{userId}
	</update>
	<update id="updateAvatar">
		update users set avatar = #{avatar}
		where user_id=#{userId}
	</update>
</mapper>